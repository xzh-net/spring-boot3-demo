# Spring AI + OpenAI + PGVector 实现本地RAG

上一个示例仅使用`spring-ai`调用向量模型，再通过`milvus-sdk`将数据插入向量库并检索。

现在我们先使用`spring-ai`中的`vector-store-pgvector`方式将数据插入。用户提问先根据问题从向量库中搜索响应的段落，然后构建封装prompt和调用大模型的方法。


## HNSW 和 IVFFlat 的区别和使用场景

HNSW（Hierarchical Navigable Small World）

- **算法原理**：构建分层图结构，每层都是可导航的小世界图
- **搜索方式**：从顶层开始逐层导航，快速接近目标区域
- **最大维度**：2000

IVFFlat（Inverted File with Flat storage）

- **算法原理**：通过聚类将向量空间划分为多个分区（Voronoi 单元）
- **搜索方式**：先找到最近的几个分区，然后在分区内进行精确搜索
- **最大维度**：16000

## 使用场景推荐

### 🎯 选择 HNSW 的场景：

1. **对查询精度要求高**的应用
2. **中等数据规模**（百万级以内）
3. **查询性能优先**的场景
4. **数据分布复杂或未知**
5. **内存资源充足**

**典型应用**：推荐系统、语义搜索、相似图片检索

### 🎯 选择 IVFFlat 的场景：

1. **超大规模数据集**（亿级以上）
2. **内存资源有限**
3. **可以接受一定精度损失**
4. **数据分布相对均匀**
5. **需要快速构建索引**

**典型应用**：电商商品搜索、文档检索、日志分析

## 使用场景

- 智能问答：基于知识库的RAG问答
- 多格式支持：PDF、Word、TXT等文档
- 向量存储：PostgreSQL + pgvector
- 流式响应：支持实时对话

## 环境配置

```bash
# 确保PostgreSQL已安装pgvector扩展
CREATE EXTENSION IF NOT EXISTS vector;
```

## 注意事项

1. 需要安装Higress v2.1.8，将聊天模型和向量模型全部配置以网关地址访问。
2. 本例中向量模型维度是4096，配置文件中临时关闭了创建索引的配置。可以手动开启`ivfflat`。
3. 默认支持最大10MB文件上传。

